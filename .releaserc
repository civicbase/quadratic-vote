branches:
  - main
  - name: alpha
    prerelease: true
debug: true
ci: true
dryRun: false
plugins:
  - '@semantic-release/commit-analyzer'
  - '@semantic-release/release-notes-generator'
  # Publish to npm via Trusted Publishing (OIDC). No npm tokens.
  - - '@semantic-release/exec'
    - prepareCmd: 'npm version ${nextRelease.version} --no-git-tag-version && npm run build'
      publishCmd: 'npm publish --provenance --access public'
      # If publish fails after creating the tag, clean it up so the next run can retry.
      failCmd: 'git push https://x-access-token:${GITHUB_TOKEN}@github.com/civicbase/quadratic-vote.git --delete v${nextRelease.version} || true; git tag -d v${nextRelease.version} || true'
  - - '@semantic-release/github'
    # Avoid extra API calls / issues during failure reporting; publishing releases still works.
    - successComment: false
      failComment: false
